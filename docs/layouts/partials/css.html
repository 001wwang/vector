{{ $server := site.IsServer }}
{{ $isHome := site.Home }}
{{ $includePaths := slice "node_modules" }}
{{ $cssOpts := cond $server (dict "includePaths" $includePaths "enableSourceMap" true) (dict "includePaths" $includePaths "outputStyle" "compressed") }}
{{ $postCssOpts := dict "inlineImports" true }}
{{ $cssInputs := site.Params.css }}

{{ range $cssInputs }}
{{ $opts := merge $cssOpts (dict "targetPath" .output) }}
{{ $css := resources.Get .input | resources.ExecuteAsTemplate .input . | toCSS $opts }}
{{ if .postcss }}
{{ $css = $css | postCSS $postCssOpts }}
{{ end }}

{{ if not (and .home_page_only (not $isHome)) }}
{{ if $server }}
<link rel="stylesheet" href="{{ $css.RelPermalink }}">
{{ else }}
{{ $css = $css | fingerprint }}
<link rel="stylesheet" href="{{ $css.RelPermalink }}" integrity="{{ $css.Data.Integrity }}">
{{ end }}
{{ end }}
{{ end }}