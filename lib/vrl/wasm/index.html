<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>vrl-wasm</title>
  </head>
  <body>
    <h1>
      Result:
    </h1>

    <div id="result"></div>

    <script type="module">
      import { default as wasm, resolve } from "./pkg/vrl_wasm.js";

      wasm().then((module) => {
        const program = `
          . |= parse_key_value!(string!(.message))
          del(.message)
          .timestamp = format_timestamp!(to_timestamp!(.timestamp), format: "%+")
          .id = uuid_v4()
        `;

        const input = {
          program: program,
          event: {
            message: "foo=bar bar=baz",
            timestamp: "2021-03-02T18:51:01.513Z"
          }
        };

        let result = resolve(input);
        let json = JSON.stringify(result, null, '\t');

        document.getElementById('result').innerHTML = `<p>${json}</p>`;
      });
    </script>
  </body>
</html>
