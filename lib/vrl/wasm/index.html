<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>vrl-wasm</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma-rtl.min.css" />

    <style>
      .code-output {
        margin: 1rem 0 2rem 0;
        background-color: black;
        color: white;
        padding: 0.75rem;
        font-size: 1rem;
        border-radius: 0.5rem;
        font-family: monospace;
      }
    </style>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <section class="section">
      <div class="container">
        <p class="is-size-3">
          Program
        </p>

        <p id="program" class="code-output"></p>

        <p class="is-size-3">
          Output
        </p>

        <p id="output" class="code-output"></p>

        <p class="is-size-3">
          Result
        </p>

        <p id="result" class="code-output"></p>
      </div>
    </section>


    <script type="module">
      import { default as wasm, resolve } from "./pkg/vrl_wasm.js";

      wasm().then((module) => {
        const program = `. |= parse_key_value!(string!(.message))
          del(.message)
          .timestamp = format_timestamp!(to_timestamp!(.timestamp), format: "%+")
          .id = uuid_v4()
        `;

        const input = {
          program: program,
          event: {
            message: "foo=bar bar=baz",
            timestamp: "2021-03-02T18:51:01.513Z"
          }
        };

        $(() => {
          let result = resolve(input);

          $('#program').html(program.replaceAll('\n', '<br>'));
          $('#output').html(result.output);
          $('#result').html(JSON.stringify(result.result));
        });
      });
    </script>
  </body>
</html>
