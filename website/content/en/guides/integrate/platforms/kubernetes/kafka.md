---
$schema: "../../../.schema.json"
title: "Send logs from Kubernetes to Kafka"
description: "A simple guide to send logs from Kubernetes to Kafka in just a few minutes."
author_github: https://github.com/binarylogic
cover_label: "Kubernetes to Kafka Integration"
tags: ["type: tutorial","domain: platforms","domain: sinks","platform: kubernetes","source: kubernetes_logs","sink: kafka"]
hide_pagination: true
---

import CodeExplanation from '@site/src/components/CodeExplanation';
import ConfigExample from '@site/src/components/ConfigExample';
import DaemonDiagram from '@site/src/components/DaemonDiagram';
import Jump from '@site/src/components/Jump';
import Steps from '@site/src/components/Steps';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

Logs are an _essential_ part of observing any
service; without them you'll have significant blind spots. But collecting and
analyzing them can be a real challenge -- especially at scale. Not only do you
need to solve the basic task of collecting your logs, but
you must do it in a reliable, performant, and robust manner. Nothing is more
frustrating than having your logs pipeline fall on it's
face during an outage, or even worse, cause the outage!

Fear not! In this guide we'll build an observability pipeline that will
send logs from Kubernetes to Kafka.

<!--
    THIS FILE IS AUTOGENERATED!

    To make changes please edit the template located at:

    guides/integrate/platforms/kubernetes/kafka.md.erb
-->

## Background

### What is Kubernetes?

[Kubernetes](https://kubernetes.io), also known as k8s, is an
open-source container-orchestration system for automating
application deployment, scaling, and management.

### What is Kafka?

[Apache Kafka](https://kafka.apache.org/) is an open-source project for a distributed publish-subscribe messaging system rethought as a distributed commit log. Kafka stores messages in topics that are partitioned and replicated across multiple brokers in a cluster. Producers send messages to topics from which consumers read. These features make it an excellent candidate for durably storing logs and metrics data.

## Strategy

### How This Guide Works

We'll be using [Vector][urls.vector_website] to accomplish this task. Vector
is a [popular][urls.vector_stars] [open-source][urls.vector_repo] observability
data pipeline. It's written in [Rust][urls.rust], making it lightweight,
[ultra-fast][urls.vector_performance] and highly reliable. And we'll be
deploying Vector as a [agent][docs.roles#agent].

<DaemonDiagram
  platformName={"kubernetes"}
  sourceName={"kubernetes_logs"}
  sinkName={"kafka"} />

### What We'll Accomplish

We'll build an observability data pipeline that:

<div className="list--icons list--icons--checks list--indent">

  * Collects all log data for Kubernetes Nodes, automatically enriching data with Kubernetes metadata via the Kubernetes API.
    * Enriches data with useful Kubernetes context.
    * Efficiently collects data and checkpoints read positions to ensure data is not lost between restarts.
  * Sends logs and metrics to [Kafka](https://kafka.apache.org/).
    * Buffers data in-memory or on-disk for performance and durability.
    * Compresses data to optimize bandwidth.
    * Automatically retries failed requests, with backoff.
    * Securely transmits data via Transport Layer Security (TLS).
    * Batches data to maximize throughput.

</div>

**All in just a few minutes!**

## Tutorial

<Tabs
  centered={false}
  className={null}
  defaultValue={"helm3"}
  groupId="integration-guide-kubernetes.kubernetes_logs.kafka_interface"
  placeholder="Please choose an installation method..."
  select={true}
  values={[{"group":null,"label":"Helm 3","value":"helm3"},{"group":null,"label":"kubectl","value":"kubectl"}]}>
<TabItem value="helm3">

<Tabs
  block={true}
  defaultValue="latest"
  groupId="tabs_version"
  select={true}
  values={[{"label":"latest","value":"latest"}]}>
<TabItem value="latest">

<Tabs
  block={true}
  defaultValue="toml"
  groupId="tabs_config_format"
  select={true}
  values={[{"label":"toml","value":"toml"}]}>
<TabItem value="toml">

<Tabs
  block={true}
  defaultValue="agent"
  groupId="role"
  values={[{"label":"Agent Role","value":"agent"}]}>
<TabItem value="agent">

<Steps headingDepth={3}>

1.  ### Add the Vector repo

    ```bash
    helm repo add timberio https://packages.timber.io/helm/latest

1.  ### Check available Helm chart configuration options

    ```bash
    helm show values timberio/vector-agent

1.  ### Configure Vector

    ```bash
    cat <<-'VALUES' > values.yaml
    # The Vector Kubernetes integration automatically defines a
    # kubernetes_logs source that is made available to you.
    # You do not need to define a log source.
    sinks:
      # Adjust as necessary. By default we use the console sink
      # to print all data. This allows you to see Vector working.
      # /docs/reference/sinks/
      stdout:
        type: console
        inputs: ["kubernetes_logs"]
        target: "stdout"
        encoding: "json"
    VALUES

1.  ### Install Vector

    ```bash
    helm install --namespace vector --create-namespace vector timberio/vector-agent --values values.yaml

1. ### Observe Vector

    <Tabs
      className="mini"
      defaultValue="logs"
      values={[
        {
          label: "Logs",
          value: "logs",
        },
      ]}
    >
    <TabItem value="logs">

    ```bash
    kubectl logs --namespace vector daemonset/vector-agent
    ```

    <CodeExplanation>

    This command accesses Vector's own logs. For more information, please refer to
    the [logs section][docs.monitoring#logs] in the [monitoring guide][docs.monitoring].

    </CodeExplanation>

    </TabItem>
    </Tabs>

</Steps>

</TabItem>
</Tabs>

</TabItem>

</Tabs>
</TabItem>

</Tabs>

</TabItem>
<TabItem value="kubectl">

<Tabs
  block={true}
  defaultValue="latest"
  groupId="tabs_version"
  select={true}
  values={[{"label":"latest","value":"latest"}]}>
<TabItem value="latest">

<Tabs
  block={true}
  defaultValue="toml"
  groupId="tabs_config_format"
  select={true}
  values={[{"label":"toml","value":"toml"}]}>
<TabItem value="toml">

<Tabs
  block={true}
  defaultValue="agent"
  groupId="role"
  values={[{"label":"Agent Role","value":"agent"}]}>
<TabItem value="agent">

<Steps headingDepth={3}>

1.  ### Define Vector's namespace

    ```bash
    kubectl create namespace --dry-run=client -oyaml vector > namespace.yaml

1.  ### Prepare kustomization

    ```bash
    cat <<-'KUSTOMIZATION' > kustomization.yaml
    # Override the namespace of all of the resources we manage.
    namespace: vector

    bases:
      # Include Vector recommended base (from git).
      - github.com/timberio/vector/distribution/kubernetes/vector-agent?ref=v0.11

    images:
      # Override the Vector image to avoid use of the sliding tag.
      - name: timberio/vector
        newName: timberio/vector
        newTag: 0.11.X-debian

    resources:
      # A namespace to keep the resources at.
      - namespace.yaml

    configMapGenerator:
      # Provide a custom `ConfigMap` for Vector.
      - name: vector-agent-config
        files:
          - vector-agent.toml

    generatorOptions:
      # We do not want a suffix at the `ConfigMap` name.
      disableNameSuffixHash: true
    KUSTOMIZATION

1.  ### Configure Vector

    <ConfigExample
      config={{"sources":{"kubernetes_logs":{"type":"kubernetes_logs"}},"sinks":{"out":{"type":"kafka","inputs":["my-source-or-transform-id","prefix-*"],"bootstrap_servers":"10.14.22.123:9092,10.14.23.332:9092","key_field":"user_id","topic":"topic-1234","encoding":{"codec":"json"},"inputs":["kubernetes_logs"]}}}}
      format={"toml"}
      template={"cat <<-'VECTORCFG' > vector-agent.toml\n# The Vector Kubernetes integration automatically defines a\n# `kubernetes_logs` source that is made available to you.\n# You do not need to define a log source.\n\n{config}\nVECTORCFG"} />

1.  ### Verify the config

    ```bash
    kubectl kustomize

1.  ### Install Vector

    ```bash
    kubectl apply -k .

1. ### Observe Vector

    <Tabs
      className="mini"
      defaultValue="logs"
      values={[
        {
          label: "Logs",
          value: "logs",
        },
      ]}
    >
    <TabItem value="logs">

    ```bash
    kubectl logs -n vector daemonset/vector-agent
    ```

    <CodeExplanation>

    This command accesses Vector's own logs. For more information, please refer to
    the [logs section][docs.monitoring#logs] in the [monitoring guide][docs.monitoring].

    </CodeExplanation>

    </TabItem>
    </Tabs>

</Steps>

</TabItem>
</Tabs>

</TabItem>

</Tabs>
</TabItem>

</Tabs>

</TabItem>
</Tabs>

## Next Steps

Vector is _powerful_ tool and we're just scratching the surface in this
guide. Here are a few pages we recommend that demonstrate the power and
flexibility of Vector:

<Jump to="https://github.com/timberio/vector" leftIcon="github" target="_blank">
  <div className="title">Vector Github repo <span className="badge badge--primary"><i className="feather icon-star"></i> 4k</span></div>
  <div className="sub-title">Vector is free and open-source!</div>
</Jump>

<Jump to="/docs/setup/quickstart/" leftIcon="book">
  <div className="title">Vector quickstart</div>
  <div className="sub-title">Get setup in just a few minutes</div>
</Jump>

<Jump to="/docs/about/what-is-vector/" leftIcon="book">
  <div className="title">Vector documentation</div>
  <div className="sub-title">Everything you need to know about Vector</div>
</Jump>

[docs.monitoring#logs]: /docs/administration/monitoring/#logs
[docs.monitoring]: /docs/administration/monitoring/
[docs.roles#agent]: /docs/setup/deployment/roles/#agent
[urls.rust]: https://www.rust-lang.org/
[urls.vector_performance]: /#performance
[urls.vector_repo]: https://github.com/timberio/vector
[urls.vector_stars]: https://github.com/timberio/vector/stargazers
[urls.vector_website]: 
