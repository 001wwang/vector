{{ $category := .Get 0 }}
{{ $funcs := slice }}
{{ range $k, $func := site.Data.docs.remap.functions }}
{{ if eq $func.category $category }}
{{ $funcs = $funcs | append . }}
{{ end }}
{{ end }}

<div class="no-prose flex flex-col divide-y divide-gray-200 dark:divide-gray-700 dark:border-gray-700 border rounded-md shadow-sm">
  {{ range $funcs }}
  {{ $name := .name }}
  {{ $func := index site.Data.docs.remap.functions .name }}
  {{ $infallible := not $func.internal_failure_reasons }}
  {{ $args := $func.arguments }}
  {{ $lastArg := sub (len $args) 1 }}
  {{ $return := $func.return }}
  <div class="py-4 px-6">
    {{/* Function title */}}
    <span class="flex justify-between items-center">
      <h3 id="{{ $name }}" class="font-mono">
        <a href="#{{ $name }}" class="text-white">
          {{ $name }}
        </a>
      </h3>

      {{/* Badges */}}
      <span class="flex space-x-1">
        {{ if $infallible }}
        {{ partial "badge.html" (dict "word" "infallible" "color" "blue") }}
        {{ else }}
        {{ partial "badge.html" (dict "word" "fallible" "color" "red") }}
        {{ end }}
      </span>
    </span>

    {{/* Function description */}}
    <div class="mt-4 text-md">
      {{ $func.description | markdownify }}
    </div>

    {{/* Function spec */}}
    <div class="mt-2.5 border rounded-md py-3 px-4 dark:border-gray-700">
      <span class="font-semibold text-md">
        Function spec
      </span>

      <div class="my-2 font-mono text-sm bg-dark dark:bg-black px-3.5 py-2.5 rounded text-gray-100">
        <span class="text-primary dark:text-primary font-semibold">{{ $name }}</span>(
          {{- range $idx, $arg := $args -}}
          {{ $isLast := eq $idx $lastArg -}}
          <span class="{{ if .required }} font-bold text-orange-400{{ else }} font-semibold text-purple-400{{ end }}">
            {{- .name -}}
          </span>:
          <span class="text-gray-200"><{{ delimit .type `<span class="text-grey-500"> | </span>` }}></span>{{ if not $isLast }}, {{ end -}}
          {{ end -}}
        )
        {{- with $return -}}
        <div class="ml-3">
          <span class="font-extrabold">::</span> <span class="text-gray-200"><{{ delimit .types " | " }}></span>
        </div>
        {{- end -}}
      </div>

      {{/* Function arguments */}}
      <div class="flex flex-col space-y-2">
        {{ range $args }}
        {{ template "arg" . }}
        {{ end }}
      </div>

      <div class="mt-6 flex flex-row-reverse">
        {{ template "legend" }}
      </div>
    </div>
  </div>
  {{ end }}
</div>

{{ define "legend" }}
{{/* Heroicon: outline/map */}}
<div class="flex items-center space-x-2">
  <svg xmlns="http://www.w3.org/2000/svg" class="text-gray-400 dark:text-gray-300 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
  </svg>

  <span class="font-mono text-xs text-orange-400 font-semibold">
    required
  </span>

  <span class="font-mono text-xs text-purple-400 font-semibold">
    optional
  </span>

  <span class="font-mono text-xs text-gray-500 dark:text-gray-300 font-semibold">
    &lt;types | ...&gt;
  </span>
</div>
{{ end }}

{{ define "arg" }}
<div class="flex flex-col space-y-0.5">
  <span class="flex justify-between items-center">
    <span class="font-mono tracking-tight{{ if .required }} font-extrabold text-orange-400{{ else }} font-semibold text-purple-400{{ end }}">
      {{ .name }}
    </span>

    <span class="font-mono text-gray-500 dark:text-gray-300 text-sm">
      {{ delimit .type " | " }}
    </span>
  </span>

  <div class="leading-snug ml-4">
    {{ .description | markdownify }}
  </div>
</div>
{{ end }}